---
title: "사용자 수에 따른 규모 확장성"
categories:
  - Software Engineering
tags:
  - CAP Theorem
  - System Design
  - System Design Interview
toc: true
toc_sticky: true
toc_label: "CAP Theorem"
toc_icon: "book"
---
## 서론
대규모 사용자를 지원하는 시스템을 설계하는 것은 도전적인 과제이며, 지속적인 개선과 성능 최적화가 필요합니다

## 가장 기초적인 단일 서버를 설계 해보자
간단한 시스템의 경우 모든 컴포넌트가 하나의 서버에서 실행될 수 있습니다. 아래는 기본적인 단일 서버 시스템의 구성을 보여주는 다이어그램입니다.

![Untitled Diagram drawio (2)](https://github.com/sungbinlee/sungbinlee.github.io/assets/52542229/89725c23-3b30-4f5c-b545-d83621bb12af)

## 어떤 데이터베이스를 사용할 것인가?

데이터베이스 선택은 시스템의 성능과 효율성에 큰 영향을 미칩니다. 대부분의 경우, 관계형 데이터베이스와 NoSQL 데이터베이스 중에서 선택해야 합니다.

### RDBMS: 관계형 데이터 베이스

- MySQL, Oracle DB, PostgreSQL 등이 있습니다.
- 자료를 테이블과 열, 컬럼으로 표현하며, Join을 통해 여러 관계를 합칠 수 있습니다.

### NoSQL: 비 관계형 데이터 베이스

- MongoDB, DynamoDB, Cassandra 등이 있습니다.
- 키-값 저장소, 그래프 저장소, 칼럼 저장소, 문서 저장소 등으로 구분됩니다.
- Join 연산을 지원하지 않지만, 대량의 데이터를 저장하고 빠른 응답 시간을 제공하는 데 특화되어 있습니다.

데이터베이스 선택은 다음과 같은 상황에서 NoSQL이 유리할 수 있습니다:
- 아주 낮은 응답 지연 시간이 필요한 경우
- 다루는 데이터가 비정형이거나 다양한 형식을 가질 때
- 데이터를 직렬화하거나 역직렬화할 수 있으면 충분한 경우
- 대량의 데이터를 저장하고 효율적으로 처리해야 할 때

## 규모를 확장해보자: 수직적 규모 확장 vs 수평적 규모 확장
서버 확장은 수직적 확장(Vertical Scaling)과 수평적 확장(Horizontal Scaling) 두 가지 방법으로 나뉩니다.

### 수직적 확장(Vertical Scaling)
단일 서버의 성능을 향상시키기 위해 해당 서버의 하드웨어 사양을 업그레이드하는 방식입니다. 즉, 높은 사양의 서버로 스케일 업하는 것을 의미합니다.
- 장점:
  - 단일 서버에서의 구현이 비교적 간단합니다.
  - 서버에 유입되는 트래픽이 적을 때 효과적입니다.

- 단점:
  - 성능 증가에 한계가 있습니다. 서버의 CPU나 메모리를 무한정으로 증설할 수 없습니다.
  - 비용이 선형적으로 증가하는 것보다 더 빠르게 증가합니다.
  - 단일 서버에 장애가 발생하면 전체 서비스가 중단될 수 있습니다.

### 수평적 확장 (Horizontal Scaling)
서버의 대수를 증가시켜 트래픽을 여러 서버로 분산하는 방식입니다. 다수의 서버로 스케일 아웃하는 것을 의미합니다.
- 장점:
  - 성능 증가에 한계가 적습니다. 필요에 따라 서버를 추가하여 확장할 수 있습니다.
  - 단일 서버에 장애가 발생해도 다른 서버가 계속 서비스를 제공할 수 있습니다.
- 단점:
  - 구현이 복잡할 수 있습니다.
  - 서버 간의 동기화와 데이터 일관성을 관리해야 합니다.

## 웹 계층에서의 다중화(로드밸런서)
앞서 설계에서는 웹 서버와 사용자 간의 직접적인 연결이 있어, 서버 다운 시 사용자에게 서비스를 제공할 수 없거나 응답 속도가 느려질 수 있습니다. 이러한 문제를 해결하기 위해 로드밸런서를 도입하는 것이 최선입니다.

![lb](https://github.com/sungbinlee/sungbinlee.github.io/assets/52542229/766459c8-48b8-4f59-8f53-90f291e8d86a)

로드밸런서는 웹 서버와 사용자 간의 연결을 관리하며, 이를 통해 서버에 대한 트래픽을 균형 있게 분산시킵니다. 이는 서버에 발생하는 과부하를 방지하고 응답 시간을 최적화하여 사용자 경험을 향상시킵니다. 위의 그림에서 볼 수 있듯이, 사용자는 로드 밸런서의 공개 IP 주소를 통해 서비스에 접속할 수 있습니다. 이 과정에서 서버 간 통신에는 사설 IP 주소가 사용되어 더 나은 보안을 제공합니다. 이 사설 IP 주소는 인터넷을 통한 외부 접속이 불가능하며, 같은 네트워크 내에서만 통신이 이루어집니다.

로드밸런서는 한 서버에 장애가 발생했을 때 자동으로 다른 서버로 트래픽을 전환하여 서비스의 지속성을 유지합니다. 이를 통해 웹 서비스의 가용성과 안정성을 향상시킬 수 있습니다.

## 데이터 계층에서의 다중화

데이터 계층에서의 다중화는 데이터의 복제와 분산을 의미합니다. 주로 사용되는 방식 중 하나는 주-부(Master-Slave) 관계 설정입니다. 이 구성에서 주 서버는 쓰기 작업을 처리하고, 부 서버는 주 서버의 데이터를 복제하여 읽기 작업만을 처리합니다.

![_db drawio](https://github.com/sungbinlee/sungbinlee.github.io/assets/52542229/dd89b6d5-5676-4e33-9c08-56d3948500ba)

주 서버는 insert, delete, update 와 같은 쓰기 작업을 수행합니다. 부 서버는 읽기 작업을 처리하기 위해 마스터 서버의 데이터를 복제하여 자체적으로 읽기 요청에 응답합니다. 이러한 구성은 데이터의 안정성과 가용성을 향상시키며, 읽기 작업을 분산시켜 전체 시스템의 성능을 향상시킵니다. 대부분의 애플리케이션에서는 읽기 연산이 쓰기 연산보다 더 많이 발생하기 때문에, 이러한 다중화 구성은 데이터베이스 에서 읽기 작업을 효율적으로 처리하기 위한 중요한 전략 입니다.
